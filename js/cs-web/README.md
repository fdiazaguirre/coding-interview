This code was tested on spidermonkey console and with gjtest in v8.